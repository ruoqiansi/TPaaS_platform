{% extends "base.html" %}

{% block page_content %}
    <div class="row">
    <!--form class="form-horizontal center-block" id="frm_buildQuery" role="form" method="post" action={{url_for('build.build_query')}}-->
    <form class="form-horizontal center-block" id="frm_buildQuery" role="form" method="post">
     <div class="row">
         <label class="col-xs-2 control-label">Branch:</label>
         <div class='col-xs-2'>
            <select class="selectpicker" name="branch_select" data-live-search="true">
                <option selected="selected">all</option>
                {% for branch in build_branch %}
                   <option>{{ branch.branch_name }}</option>
                {% endfor %}
            </select>
        </div>

         <label class="col-xs-2 control-label">Platform:</label>
         <div class='col-xs-2'>
            <select class="selectpicker" name="platform_select" data-live-search="true">
                <option selected="selected">all</option>
                {% for platform in build_platform %}
                    <option>{{ platform | join('-') }}</option>
                {% endfor %}
            </select>
         </div>
     </div>
     <div class="row">
         <label class="col-xs-2 control-label">Date:</label>
         <div class="col-xs-3">
            <div class="input-group input-daterange" name="build_date">
                <input type="text" class="form-control input1" placeholder="Start Date" readonly>
                <div class="input-group-addon">-</div>
                <input type="text" class="form-control input2" placeholder="End Date" readonly>
            </div>
        </div>
     </div>
     <div class="row">
        <div class="col-xs-2">
           <a href="javascript:void(0);" onclick="POSTInQuery('/build_query/')" class="btn btn-default">Search</a>
        </div>
     </div>
    </form>
    </div>
    <br>
    <table class="table table-striped table-hover" id="tbl_buildList">
    <tr>
        <th>Build Date</th>
        <th>Build Version</th>
        <th>Build Platform</th>
        <th>Build Server</th>
        <th>Last Commit</th>
        <th>Commit Details</th>
        <th>Package Repo</th>
    </tr>
    {% for build in build_history %}
    <tr>
        <td>{{ build.build_date }}</td>
        <td>{{ build.build_version }}</td>
        <td>{{ build.build_platform }}</td>
        <td>{{ build.build_server }}</td>
        <td>{{ build.last_commit }}</td>
        <td>{{ build.commit_details }}</td>
        <td>{{ build.package_repo }}</td>
    </tr>
    {% endfor %}
    </table>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="text/javascript">
    function POSTInQuery(url) {
        data = $('#frm_buildQuery').serialize();
        $.ajax({
            type: "POST",
            url: url,
            data: JSON.stringify(data),
            contentType: 'application/json; charset=UTF-8',
            dataType: "html",
            success: function (data) {
                $("#tbl_buildList").html(data);
            },
            error: function () {
                $("#tbl_buildList").html("Failed to get data");
            }
        });
    }
    </script>
    <script>
$(document).ready(function(){

$('.input-daterange').datepicker({
format: 'dd-mm-yyyy',
autoclose: true
});

});
    </script>
{% endblock %}